<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>查询采购人</title>
		<!-- 禁止浏览器从本地机的缓存中调阅页面内容 -->
	    <meta http-equiv="Pragma" content="no-cache">
	    <!-- 用来防止别人在框架里调用你的页面 -->
	    <meta http-equiv="Window-target" content="_top">
	    <!-- content的参数有all，none，index，noindex，follow，nofollow，默认是all -->
	    <meta name="robots" content="none">
	    <!-- 收藏图标 -->
	    <link rel="Shortcut Icon" href="favicon.ico">
	    <!-- 网页不会被缓存 -->
	    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
	    <!-- 解决部分兼容性问题，如果安装了GCF，则使用GCF来渲染页面，如果未安装GCF，则使用最高版本的IE内核进行渲染。 -->
	    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	    <!-- 页面按原比例显示 -->
	    <meta name="viewport" content="width=device-width, initial-scale=1">	   
	    <!--[if lt IE 9]>
	       <script src="https://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	       <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.js"></script>
	    <![endif]-->
		<link rel="stylesheet" href="../../../../../media/js/bootstrap/css/bootstrap.min.css">
		<link rel="stylesheet" href="../../../../../media/js/bootstrap/css/bootstrap-table.min.css">
		
	</head>
	<body>
		<div class="container-fluid" style="margin-top: 5px;">
			
			<div id="toolbar">
	        	
	        	<div class="input-group" style="width:180px;float: left;">
		        	<span class="input-group-addon">客户名称</span>
		        	<input type="text" class="form-control" name="enterpriseName" id="enterpriseName" style="width:180px">
	        	</div>
	            <div class="btn-group" style="padding-left: 10px;">
				 	<button id="btnSearch" type="button" class="btn btn-primary">
			          <span class="glyphicon glyphicon-search" aria-hidden="true">查询
			        </button>				
		        </div>
			</div>
			
	        <table id="Purchasers" class="" data-toolbar="#toolbar"></table>
	
		</div>
		<script src="../../../../../media/js/jquery/jquery.min.js"></script>
		<script src="../../../../../media/js/jquery/jquery.extend.js" ></script>
		<script src="../../../../../media/js/bootstrap/js/bootstrap.js"></script>
		<script src="../../../../../media/js/bootstrap/js/bootstrap-table.min.js"></script>
		<script src="../../../../../media/js/bootstrap/js/bootstrap-table-zh-CN.min.js"></script>
		<script src="../../../../../media/js/base/index.js"></script>
		<script src="../../../../../media/js/layer/layer.js"></script>
		<script src="../../../../../media/js/base/common.js"></script>
		<script type="text/javascript">
			//var searchUrl = config.Syshost + "/EnterpriseTypeController/findEnterprisePage.do"; //根据企业类型查找企业
			var saveUrl = parent.config.AuctionHost + "/SupplierController/insertSupplierApply";//保存接口
			var searchPachaser =parent.config.Syshost + "/EnterpriseController/findEnterprisePageForApp.do";
			var pricedelete=config.AuctionHost +'/ProjectPriceController/deleteProjectPriceByPackage.do'//费用删除
			
			var projectId = getUrlParam("projectId");
			var tenderTypeCode = getUrlParam("tenderType");
			//页面加载后显示
			$(function() {
				//查询按钮
				$("#btnSearch").on('click', function() {		
					$('#Purchasers').bootstrapTable('refresh', {
						url:searchPachaser
					});
				});
			
			});
			
			//设置查询条件
			function queryParams(params) {
				return {
					'enterprise.enterpriseName':$("#enterpriseName").val(),
					'enterpriseType':'04',
					'pageNumber':params.offset/params.limit+1,//当前页数
					'pageSize': params.limit, // 每页显示数量
					'offset':params.offset, // SQL语句偏移量	
				}
			}									
			//var enterprojectId= JSON.parse(sessionStorage.getItem('enterprojectId'));//项目id
			var PurchasersData="";
			var projectCode="";
			var PurchasersData_data;
			function du(uid){
					//表格初始化
				PurchasersData_data=uid
				$("#Purchasers").bootstrapTable({
					url:searchPachaser,
					dataType: 'json',
					method: 'get',
					locale: "zh-CN",
					pagination: true, // 是否启用分页
					showPaginationSwitch: false, // 是否显示 数据条数选择框
					pageSize: 10, // 每页的记录行数（*）
					pageNumber: 1, // table初始化时显示的页数
					pageList: [10, 15, 20, 25],
					height:'515',
					toolbar: '#toolbar', // 工具栏ID
					clickToSelect: true, //是否启用点击选中行
					sidePagination: 'server', // 服务端分页
					classes: 'table table-bordered', // Class样式
					silent: true, // 必须设置刷新事件
					queryParams: queryParams, //查询条件参数
					columns: [
						[
							{field: 'enterprise.enterpriseName',title: '客户名称'},
				            {field: 'enterprise.enterpriseCode',title: '企业代码'},
				            {field: '#',title: '操作',width:'100',formatter: function(value, row, index) {
				            	  var deletes='<button href="javascript:void(0)" type="button" class="btn-sm btn-primary" style="text-decoration:none;border: none;" onclick=btn(\"'+index+'\",\"'+row.enterpriseId+'\")>'
										   +'选择'
										+'</button>'
								   var selectBox='<button href="javascript:void(0)" type="button" class="btn-sm btn-danger" style="text-decoration:none;border: none;">'
									   +'已选择'
									+'</button>'
									if(PurchasersData_data != null && PurchasersData_data != "" ) {								
										if(PurchasersData_data == row.enterpriseId) {									
										  return '<div class="btn-group-sm" >'+selectBox+'</div>';						        		
										}else{
											return '<div class="btn-group-sm" >'+deletes+'</div>';
										}
									}else{
										return '<div class="btn-group-sm" >'+deletes+'</div>';
									}
				            	  
				            }
				            },
						
						]
					]
				});
			}
			
			function btn($index,uid){				
				var rowData=$('#Purchasers').bootstrapTable('getData');//bootstrap获取当前页的数据
				PurchasersData=rowData[$index];
				var dcmt = parent.iframeWind;
					
				//dcmt.form1()
				if(dcmt.$("#projectCode").val()==""){
					var pare={
							'tenderType':2,
							'enterpriseId':uid,
							'regionCode':dcmt.$("#City").val()
						}
					if(dcmt.$("#projectType").val()==3){
						pare.projeteTypeCode='GX'
					}
					if(dcmt.isDf==true&&dcmt.$("#projectType").val()==3){

					}else{
						$.ajax({
							url:config.AuctionHost+'/PurchaseController/newprojectCode.do',
							type:'post',
							dataType:'json',
							async:false,
							data:pare,
							success:function(data){
								if(data.success){
									projectCode=data.data;
									dcmt.$("#projectCode").val(projectCode);		
								}else{
									parent.layer.alert(data.message);
									projectCode=""
									return;
								}
							} 
						});
					}
				}
				sessionStorage.setItem("PurchasersData_data", JSON.stringify(rowData[$index].enterpriseId));
				PurchasersData_data = JSON.parse(sessionStorage.getItem("PurchasersData_data"));		
				dcmt.showPurchse(PurchasersData);
				//dcmt.form1()
				parent.layer.close(parent.layer.getFrameIndex(window.name));

									
			}
		 
		 
		   function getUrlParam(name) {
				var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); // 构造一个含有目标参数的正则表达式对象  
				var r = window.location.search.substr(1).match(reg); // 匹配目标参数  
				if(r != null) return unescape(r[2]);
				return null; // 返回参数值  
			} 
		</script>
	</body>
</html>
