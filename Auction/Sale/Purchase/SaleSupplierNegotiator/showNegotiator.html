<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="pragma" content="no-cache">
		<!-- 禁止浏览器从本地机的缓存中调阅页面内容 -->
		<meta http-equiv="cache-control" content="no-cache, must-revalidate">
		<meta http-equiv="expires" content="0">
		<title>查看谈判详情</title>
		<link rel="stylesheet" href="../../../../media/js/bootstrap/css/bootstrap.css">
		<link rel="stylesheet" href="../../../../media/js/bootstrap/css/bootstrap-table.css">
		<style type="text/css">
			label {
				font-weight: normal;
			}
		</style>
	</head>

	<body>
		<table id = "priceNegotiator" class="table table-bordered" style="width: 98%;margin-top: 5px;margin-left: 5px;">
     		
			<tr>
				<td class="th_bg" style="width: 160px;">谈判对象</td>
				<td><label id="supplierName"></label></td>
			</tr>
			
			<tr>
				<td class="th_bg">发起谈判时间</td>
				<td><label id="subDate"></label></td>
			</tr>
			
			<tr>
				<td class="th_bg">采购人发起的谈判价格</td>
				<td><label id="negotiationPrice"></label></td>
			</tr>
			<tr>
				<td class="th_bg">价格确认截止时间</td>
				<td><label id="endDate"></label></td>
			</tr>
			<tr>
				<td class="th_bg">采购人发出的谈判内容</td>
				<td><label id="content"></label></td>
			</tr>
			
			<tr>
				<td class="th_bg">供应商回复状态</td>
				<td><label id="isAccept"></label></td>
			</tr>
			
			<tr>
				<td class="th_bg">供应商回复价格</td>
				<td><label id="replyPrice"></label></td>
			</tr>
			
			<tr>
				<td class="th_bg">供应商回复时间</td>
				<td><label id="replyDate"></label></td>
			</tr>		
			
			<tr>
				<td class="th_bg">供应商回复内容</td>
				<td><label id="replyContent"></label></td>
			</tr>
			
			<tr>
				<td class="th_bg">上传附件</td>
				<td id="fileUp"></label></td>
			</tr>
		</table>

	</body>
	<script type="text/javascript" src="../../../../media/js/jquery/jquery.js"></script>
	<script src="../../../../media/js/jquery/jquery.extend.js"></script>

	<script type="text/javascript" src="../../../../media/js/bootstrap/js/bootstrap.js"></script>
	<script type="text/javascript" src="../../../../media/js/bootstrap/js/bootstrap-table.min.js"></script>
	<script src="../../../../media/js/bootstrap/js/bootstrap-table-zh-CN.min.js"></script>
	<script type="text/javascript" src="../../../../media/js/layer/layer.js"></script>
	<script>
		var loadFile = parent.config.FileHost + "/FileController/download.do"; //文件下载地址
		var findFiles = parent.config.AuctionHost + "/PurFileController/list.do" //查找文件

		function tableShow(obj, items) { //谈判记录 谈判明细

			$("#supplierName").text(items.supplierName);
			$("#subDate").text(items.subDate);
			$("#negotiationPrice").text(items.negotiationPrice);
			$("#endDate").text(items.endDate);
			$("#content").text(items.content);
			if(items.isAccept == '1') { //不接受
				$("#isAccept").text("不接受");
			} else if(items.isAccept == '0') {
				$("#isAccept").text("已接受");
			} else {
				$("#isAccept").text("未答复");
			}

			$("#replyPrice").text(items.replyPrice);
			$("#replyDate").text(items.replyDate);
			$("#replyContent").text(items.replyContent);

			//文件下载
			fileDownload(items.id);
		}

		var fileList;

		function fileDownload(id) {
			//根据modelId和modelName查找所有的附件
			$.ajax({
				type: "post",
				url: findFiles,
				async: true,
				data: {
					'modelId': id,
					'modelName': "JJ_PUR_NEGOTIATION_ITEM"
				},
				datatype: 'json',
				success: function(data) {
					if(data.success) {

						fileList = data.data;
						var html = "";
						for(var i = 0; i < fileList.length; i++) {
							html += "<a href='javascript:void(0)' onclick=downloadFile(" + i + ")>" + fileList[i].fileName + "</a>&nbsp"
						}
						//下载文件
						$("#fileUp").append(html);

					}
				}
			});

		}

		//文件下载
		function downloadFile(i) {
			var newUrl = loadFile + "?ftpPath=" + fileList[i].filePath + "&fname=" + fileList[i].fileName;
			window.location.href = $.parserUrlForToken(newUrl);
		}
	</script>

</html>