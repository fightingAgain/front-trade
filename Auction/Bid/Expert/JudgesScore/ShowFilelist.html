<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="pragma" content="no-cache">
		<!-- 禁止浏览器从本地机的缓存中调阅页面内容 -->
		<meta http-equiv="cache-control" content="no-cache, must-revalidate">
		<meta http-equiv="expires" content="0">
		<title>查看澄清文件</title>
		<link rel="stylesheet" href="../../../../media/js/bootstrap/css/bootstrap.css">
		<link rel="stylesheet" href="../../../../media/js/bootstrap/css/bootstrap-table.css" />
	</head>

	<body>
		<div style="margin: 15px;">
			<table class="bordered" id="fileslist">

			</table>
		</div>
	</body>

	<script type="text/javascript" src="../../../../media/js/jquery/jquery.js"></script>
	<script type="text/javascript" src="../../../../media/js/jquery/jquery.extend.js"></script>
	<script type="text/javascript" src="../../../../media/js/bootstrap/js/bootstrap.js"></script>
	<script type="text/javascript" src="../../../../media/js/bootstrap/js/bootstrap-table.min.js"></script>
	<script type="text/javascript" src="../../../../media/js/bootstrap/js/bootstrap-table-zh-CN.min.js"></script>
	<script type="text/javascript" src="../../../../media/js/base/util.js"></script>
	<script type="text/javascript" src="../../../../media/js/base/common.js"></script>
	<script type="text/javascript">
		$(function() {
			$.ajax({
				type: "post",
				url: top.config.bidhost + "/PurFileController/list.do",
				async: false,
				data: {
					modelId: getUrlParam("id")
				},
				success: function(data) {
					if(data.success) {
						bindData(data.data);
					}
				}
			});
		});

		function bindData(filedata) {
			$("#fileslist").bootstrapTable({
				data: filedata,
				columns: [{
						title: "序号",
						align: "center",
						halign: "center",
						width: "50px",
						formatter: function(value, row, index) {
							return index + 1;
						}
					}, {
						field: "fileName",
						halign: "center",
						title: "文件名"
					},
					{
						title: "操作",
						align: "center",
						halign: "center",
						width: "20%",
						events:{
							'click .openAccessory':function(e, value, row, index){
								var newUrl = top.config.bidhost + "/FileController/download.do?ftpPath=" + row.filePath+"&fname=" + row.fileName;;
								window.location.href = $.parserUrlForToken(newUrl);
							},
							'click .previewFile':function(e, value, row, index){
								openPreview(row.filePath);
							},
						},
						formatter: function(value, row, index) {
							var filesnames = row.fileName.substring(row.fileName.lastIndexOf(".") + 1).toUpperCase();
							var html="";
							html +="<a href='javascript:void(0)' class='btn btn-primary btn-xs openAccessory'>下载</a>&nbsp;&nbsp;"
							if(filesnames == 'PNG'||filesnames == 'JPG'||filesnames == 'JPGE'||filesnames == 'PDF'){	
								html +="<a href='javascript:void(0)' class='btn btn-primary btn-xs previewFile'>预览</a>"
							}
							return html;
							//return "<a href='javascript:void(0)' class='btn btn-primary btn-xs' onclick='openAccessory(\"" + row.fileName + "\",\"" + row.filePath + "\")'>下载</a>&nbsp;&nbsp;<a href='javascript:void(0)' class='btn btn-primary btn-xs' onclick='openPreview(\"" + row.filePath + "\")'>预览</a>";
						}
					},
				]
			})
		}

		/** 
		 * 取得url参数 
		 */
		function getUrlParam(name) {
			var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); // 构造一个含有目标参数的正则表达式对象  
			var r = window.location.search.substr(1).match(reg); // 匹配目标参数  
			if(r != null) return unescape(r[2]);
			return null; // 返回参数值  
		}
	</script>

</html>